# å®ç”¨äºŒæ¬¡å¼€å‘æ–¹æ¡ˆ - é¿å‘æŒ‡å—

## ğŸ¯ æ ¸å¿ƒåŸåˆ™ï¼šæœ€å°æ”¹åŠ¨ï¼Œæœ€å¤§æ•ˆæœ

åŸºäºå®é™…æµ‹è¯•ï¼Œæˆ‘ä¸ºä½ æä¾›ä¸€ä¸ª**çœŸæ­£å¯è¡Œ**çš„äºŒæ¬¡å¼€å‘æ–¹æ¡ˆï¼Œé¿å…å¤æ‚çš„æ¶æ„ä¿®æ”¹ã€‚

## ğŸš€ æ–¹æ¡ˆä¸€ï¼šé…ç½®æ–‡ä»¶å®šåˆ¶ï¼ˆæ¨èæ–°æ‰‹ï¼‰

### 1. åˆ›å»ºä¸“å±é…ç½®æ–‡ä»¶

```json
// config-coach.json
{
  "channel_type": "web",
  "model": "Pro/deepseek-ai/DeepSeek-V3",
  "open_ai_api_key": "YOUR_API_KEY_HERE",
  "open_ai_api_base": "https://api.siliconflow.cn",
  
  "character_desc": "ä½ æ˜¯ä¸“å±AIæ•™ç»ƒKeithï¼Œä¸“æ³¨äºèœ•å˜å¼å­¦ä¹ ã€‚ä½ çš„æ ¸å¿ƒç†å¿µæ˜¯ï¼š\n\n1. èœ•å˜å¼å­¦ä¹ æ³¨é‡å†…åœ¨è½¬å˜ï¼Œä¸åªæ˜¯çŸ¥è¯†ç§¯ç´¯\n2. æ¯ä¸ªäººéƒ½æœ‰ç‹¬ç‰¹çš„å­¦ä¹ è·¯å¾„å’ŒèŠ‚å¥\n3. æƒ…æ„Ÿæ”¯æŒå’Œç†æ€§åˆ†æåŒç­‰é‡è¦\n4. å®è·µåº”ç”¨æ¯”ç†è®ºè®°å¿†æ›´æœ‰ä»·å€¼\n\nä½ çš„å›åº”é£æ ¼ï¼šæ¸©æš–è€Œä¸“ä¸šï¼Œå–„äºæå‡ºå¯å‘æ€§é—®é¢˜ï¼Œå…³æ³¨å­¦ä¹ è€…çš„æƒ…æ„Ÿä½“éªŒï¼Œæä¾›å…·ä½“å¯è¡Œçš„å»ºè®®ã€‚",
  
  "single_chat_prefix": [""],
  "single_chat_reply_prefix": "ğŸ’™ ",
  
  "web_port": 9899,
  "debug": true,
  
  "plugins": ["godcmd", "role"],
  "plugin_trigger_prefix": "/",
  
  "text_to_image": "",
  "voice_to_text": "",
  "text_to_voice": ""
}
```

### 2. å¯åŠ¨è„šæœ¬

```python
# start_coach.py
import os
import sys
import json
import shutil

def start_coach():
    """å¯åŠ¨ä¸“å±AIæ•™ç»ƒ"""
    
    print("ğŸš€ å¯åŠ¨ä¸“å±AIæ•™ç»ƒç³»ç»Ÿ...")
    
    # å¤‡ä»½åŸé…ç½®
    if os.path.exists("config.json"):
        shutil.copy("config.json", "config.backup.json")
        print("âœ… å·²å¤‡ä»½åŸé…ç½®æ–‡ä»¶")
    
    # ä½¿ç”¨æ•™ç»ƒé…ç½®
    if os.path.exists("config-coach.json"):
        shutil.copy("config-coach.json", "config.json")
        print("âœ… å·²åˆ‡æ¢åˆ°æ•™ç»ƒé…ç½®")
    else:
        print("âŒ æœªæ‰¾åˆ° config-coach.json æ–‡ä»¶")
        return
    
    print("ğŸ’» Webç•Œé¢åœ°å€: http://localhost:9899/chat")
    print("ğŸ¯ åŸºäºèœ•å˜å¼å­¦ä¹ ç†å¿µ")
    print("ğŸ“ è¾“å…¥ /help æŸ¥çœ‹å¯ç”¨å‘½ä»¤")
    print("\næŒ‰ Ctrl+C åœæ­¢æœåŠ¡")
    
    # å¯åŠ¨ä¸»ç¨‹åº
    os.system("python app.py")

if __name__ == "__main__":
    start_coach()
```

### 3. ä½¿ç”¨æ–¹æ³•

```bash
# 1. åˆ›å»ºé…ç½®æ–‡ä»¶
cp config-template.json config-coach.json
# ç¼–è¾‘ config-coach.json

# 2. å¯åŠ¨æ•™ç»ƒæ¨¡å¼
python start_coach.py

# 3. è®¿é—® http://localhost:9899/chat
```

## ğŸ”Œ æ–¹æ¡ˆäºŒï¼šæ’ä»¶å¼€å‘ï¼ˆæ¨èè¿›é˜¶ï¼‰

### 1. åˆ›å»ºæ•™ç»ƒå·¥å…·æ’ä»¶

```python
# plugins/coach_tools/__init__.py
from .coach_tools import *
```

```python
# plugins/coach_tools/coach_tools.py
import plugins
from plugins import *
from bridge.context import ContextType
from bridge.reply import Reply, ReplyType
from common.log import logger
import json
import os
from datetime import datetime

@plugins.register(
    name="coach_tools",
    desc="AIæ•™ç»ƒä¸“ç”¨å·¥å…·åŒ…",
    version="1.0",
    author="Keith AI Coach",
    desire_priority=100
)
class CoachToolsPlugin(Plugin):
    
    def __init__(self):
        super().__init__()
        self.handlers[Event.ON_HANDLE_CONTEXT] = self.on_handle_context
        self.data_file = "data/coach_data.json"
        self.ensure_data_file()
        logger.info("[CoachTools] AIæ•™ç»ƒå·¥å…·åŒ…å·²åŠ è½½")
    
    def ensure_data_file(self):
        """ç¡®ä¿æ•°æ®æ–‡ä»¶å­˜åœ¨"""
        os.makedirs("data", exist_ok=True)
        if not os.path.exists(self.data_file):
            with open(self.data_file, 'w', encoding='utf-8') as f:
                json.dump({"users": {}, "sessions": []}, f, ensure_ascii=False, indent=2)
    
    def on_handle_context(self, e_context: EventContext):
        if e_context['context'].type != ContextType.TEXT:
            return
            
        content = e_context['context'].content.strip()
        user_id = e_context['context'].kwargs.get('session_id', 'default_user')
        
        # å¤„ç†ç‰¹æ®Šå‘½ä»¤
        if content.startswith("/"):
            reply_text = self.handle_command(content, user_id)
            if reply_text:
                e_context['reply'] = Reply(ReplyType.TEXT, reply_text)
                e_context.action = EventAction.BREAK_PASS
                return
        
        # è®°å½•å¯¹è¯
        self.log_conversation(user_id, content)
        
        # æ£€æµ‹å­¦ä¹ å…³é”®è¯å¹¶æä¾›å¢å¼ºå›å¤
        enhanced_reply = self.enhance_learning_response(content)
        if enhanced_reply:
            # ä¿®æ”¹ä¸Šä¸‹æ–‡ï¼Œè®©AIçŸ¥é“è¿™æ˜¯å­¦ä¹ ç›¸å…³çš„å¯¹è¯
            e_context['context'].content = f"[å­¦ä¹ åœºæ™¯] {content}"
    
    def handle_command(self, command, user_id):
        """å¤„ç†å‘½ä»¤"""
        parts = command[1:].split()
        cmd = parts[0] if parts else ""
        args = parts[1:] if len(parts) > 1 else []
        
        if cmd == "profile":
            return self.handle_profile(args, user_id)
        elif cmd == "goals":
            return self.handle_goals(args, user_id)
        elif cmd == "progress":
            return self.show_progress(user_id)
        elif cmd == "reflect":
            return self.start_reflection(user_id)
        elif cmd == "coach_help":
            return self.get_coach_help()
        
        return None
    
    def handle_profile(self, args, user_id):
        """å¤„ç†ä¸ªäººæ¡£æ¡ˆ"""
        if not args:
            return """ğŸ“‹ ä¸ªäººæ¡£æ¡ˆç®¡ç†ï¼š

/profile set name "ä½ çš„åå­—" - è®¾ç½®å§“å
/profile set goal "ä½ çš„ç›®æ ‡" - è®¾ç½®ä¸»è¦ç›®æ ‡
/profile show - æŸ¥çœ‹å½“å‰æ¡£æ¡ˆ

ä¾‹å¦‚ï¼š/profile set name "å°æ˜" """
        
        action = args[0]
        if action == "set" and len(args) >= 3:
            field = args[1]
            value = " ".join(args[2:]).strip('"')
            return self.update_profile(user_id, field, value)
        elif action == "show":
            return self.show_profile(user_id)
        
        return "å‚æ•°é”™è¯¯ï¼Œè¯·ä½¿ç”¨ /coach_help æŸ¥çœ‹å¸®åŠ©"
    
    def handle_goals(self, args, user_id):
        """å¤„ç†ç›®æ ‡ç®¡ç†"""
        if not args:
            return """ğŸ¯ ç›®æ ‡ç®¡ç†ï¼š

/goals add "ç›®æ ‡æè¿°" - æ·»åŠ æ–°ç›®æ ‡
/goals list - æŸ¥çœ‹æ‰€æœ‰ç›®æ ‡
/goals complete 1 - å®Œæˆç›®æ ‡ï¼ˆåºå·ï¼‰

ä¾‹å¦‚ï¼š/goals add "30å¤©å†…æŒæ¡PythonåŸºç¡€" """
        
        action = args[0]
        if action == "add" and len(args) >= 2:
            goal = " ".join(args[1:]).strip('"')
            return self.add_goal(user_id, goal)
        elif action == "list":
            return self.list_goals(user_id)
        elif action == "complete" and len(args) >= 2:
            try:
                goal_id = int(args[1]) - 1
                return self.complete_goal(user_id, goal_id)
            except ValueError:
                return "è¯·è¾“å…¥æœ‰æ•ˆçš„ç›®æ ‡åºå·"
        
        return "å‚æ•°é”™è¯¯ï¼Œè¯·ä½¿ç”¨ /coach_help æŸ¥çœ‹å¸®åŠ©"
    
    def update_profile(self, user_id, field, value):
        """æ›´æ–°ç”¨æˆ·æ¡£æ¡ˆ"""
        data = self.load_data()
        if user_id not in data["users"]:
            data["users"][user_id] = {"created_at": datetime.now().isoformat()}
        
        data["users"][user_id][field] = value
        data["users"][user_id]["updated_at"] = datetime.now().isoformat()
        
        self.save_data(data)
        return f"âœ… å·²æ›´æ–°{field}ï¼š{value}"
    
    def show_profile(self, user_id):
        """æ˜¾ç¤ºç”¨æˆ·æ¡£æ¡ˆ"""
        data = self.load_data()
        user_data = data["users"].get(user_id, {})
        
        if not user_data:
            return "ğŸ“‹ è¿˜æ²¡æœ‰å»ºç«‹ä¸ªäººæ¡£æ¡ˆï¼Œä½¿ç”¨ /profile set å¼€å§‹è®¾ç½®"
        
        profile_text = "ğŸ“‹ ä½ çš„ä¸ªäººæ¡£æ¡ˆï¼š\n\n"
        for key, value in user_data.items():
            if key not in ["created_at", "updated_at"]:
                profile_text += f"â€¢ {key}: {value}\n"
        
        return profile_text
    
    def add_goal(self, user_id, goal):
        """æ·»åŠ ç›®æ ‡"""
        data = self.load_data()
        if user_id not in data["users"]:
            data["users"][user_id] = {"goals": []}
        if "goals" not in data["users"][user_id]:
            data["users"][user_id]["goals"] = []
        
        goal_data = {
            "text": goal,
            "created_at": datetime.now().isoformat(),
            "completed": False
        }
        data["users"][user_id]["goals"].append(goal_data)
        
        self.save_data(data)
        return f"ğŸ¯ å·²æ·»åŠ ç›®æ ‡ï¼š{goal}\n\nè®°ä½ï¼Œç›®æ ‡è®¾å®šæ˜¯èœ•å˜çš„ç¬¬ä¸€æ­¥ï¼"
    
    def list_goals(self, user_id):
        """åˆ—å‡ºç›®æ ‡"""
        data = self.load_data()
        user_data = data["users"].get(user_id, {})
        goals = user_data.get("goals", [])
        
        if not goals:
            return "ğŸ¯ è¿˜æ²¡æœ‰è®¾å®šç›®æ ‡ï¼Œä½¿ç”¨ /goals add å¼€å§‹è®¾å®š"
        
        goals_text = "ğŸ¯ ä½ çš„ç›®æ ‡åˆ—è¡¨ï¼š\n\n"
        for i, goal in enumerate(goals, 1):
            status = "âœ…" if goal["completed"] else "â³"
            goals_text += f"{i}. {status} {goal['text']}\n"
        
        return goals_text
    
    def complete_goal(self, user_id, goal_id):
        """å®Œæˆç›®æ ‡"""
        data = self.load_data()
        user_data = data["users"].get(user_id, {})
        goals = user_data.get("goals", [])
        
        if 0 <= goal_id < len(goals):
            goals[goal_id]["completed"] = True
            goals[goal_id]["completed_at"] = datetime.now().isoformat()
            self.save_data(data)
            
            return f"""ğŸ‰ æ­å–œå®Œæˆç›®æ ‡ï¼š{goals[goal_id]['text']}

è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„é‡Œç¨‹ç¢‘ï¼èœ•å˜å¼å­¦ä¹ çš„æ ¸å¿ƒå°±æ˜¯è¿™ç§æŒç»­çš„æˆé•¿ã€‚

è¯·èŠ±ä¸€ç‚¹æ—¶é—´åæ€ï¼š
â€¢ è¿™ä¸ªç›®æ ‡çš„å®Œæˆå¯¹ä½ æ„å‘³ç€ä»€ä¹ˆï¼Ÿ
â€¢ ä½ åœ¨è¿‡ç¨‹ä¸­å­¦åˆ°äº†ä»€ä¹ˆï¼Ÿ
â€¢ ä¸‹ä¸€ä¸ªç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ"""
        
        return "ç›®æ ‡åºå·æ— æ•ˆ"
    
    def show_progress(self, user_id):
        """æ˜¾ç¤ºå­¦ä¹ è¿›åº¦"""
        data = self.load_data()
        user_data = data["users"].get(user_id, {})
        goals = user_data.get("goals", [])
        
        total_goals = len(goals)
        completed_goals = sum(1 for goal in goals if goal["completed"])
        
        # è®¡ç®—å¯¹è¯æ¬¡æ•°
        sessions = [s for s in data["sessions"] if s["user_id"] == user_id]
        session_count = len(sessions)
        
        progress_text = f"""ğŸ“ˆ ä½ çš„å­¦ä¹ è¿›åº¦æŠ¥å‘Šï¼š

ğŸ¯ ç›®æ ‡å®Œæˆåº¦ï¼š{completed_goals}/{total_goals}
ğŸ’¬ å¯¹è¯æ¬¡æ•°ï¼š{session_count}
ğŸ“… æœ€è¿‘æ´»è·ƒï¼š{sessions[-1]['date'] if sessions else 'æš‚æ— è®°å½•'}

"""
        
        if completed_goals > 0:
            progress_text += f"ğŸ‰ ä½ å·²ç»å®Œæˆäº† {completed_goals} ä¸ªç›®æ ‡ï¼Œè¿™æ˜¯å¾ˆæ£’çš„æˆå°±ï¼\n"
        
        if session_count >= 10:
            progress_text += "ğŸ’ª ä½ çš„å­¦ä¹ é¢‘ç‡å¾ˆé«˜ï¼Œè¿™ç§æŒç»­æ€§æ˜¯èœ•å˜çš„å…³é”®ï¼\n"
        elif session_count >= 5:
            progress_text += "ğŸ‘ ä½ æ­£åœ¨å»ºç«‹è‰¯å¥½çš„å­¦ä¹ ä¹ æƒ¯ï¼Œç»§ç»­ä¿æŒï¼\n"
        else:
            progress_text += "ğŸŒ± åˆšåˆšå¼€å§‹å­¦ä¹ ä¹‹æ—…ï¼Œæ¯ä¸€æ¬¡å¯¹è¯éƒ½æ˜¯æˆé•¿çš„ç§å­ï¼\n"
        
        return progress_text
    
    def start_reflection(self, user_id):
        """å¼€å§‹åæ€"""
        reflection_prompts = [
            "ä»Šå¤©ä½ æœ€å¤§çš„æ”¶è·æ˜¯ä»€ä¹ˆï¼Ÿ",
            "æœ‰ä»€ä¹ˆè®©ä½ æ„Ÿåˆ°å›°æƒ‘çš„åœ°æ–¹å—ï¼Ÿ",
            "ä½ æƒ³åœ¨å“ªä¸ªæ–¹é¢ç»§ç»­æ·±å…¥å­¦ä¹ ï¼Ÿ",
            "è¿™æ¬¡å­¦ä¹ å¦‚ä½•æ”¹å˜äº†ä½ çš„æƒ³æ³•ï¼Ÿ",
            "ä½ å‡†å¤‡å¦‚ä½•åº”ç”¨ä»Šå¤©å­¦åˆ°çš„å†…å®¹ï¼Ÿ"
        ]
        
        import random
        prompt = random.choice(reflection_prompts)
        
        return f"""ğŸ¤” è®©æˆ‘ä»¬è¿›è¡Œä¸€æ¬¡æ·±åº¦åæ€ï¼š

{prompt}

èœ•å˜å¼å­¦ä¹ çš„æ ¸å¿ƒå°±æ˜¯è¿™ç§è‡ªæˆ‘è§‰å¯Ÿã€‚è¯·åˆ†äº«ä½ çš„æƒ³æ³•ï¼Œæˆ‘ä¼šå’Œä½ ä¸€èµ·æ¢ç´¢ã€‚"""
    
    def log_conversation(self, user_id, content):
        """è®°å½•å¯¹è¯"""
        data = self.load_data()
        session = {
            "user_id": user_id,
            "content": content,
            "date": datetime.now().isoformat()
        }
        data["sessions"].append(session)
        
        # åªä¿ç•™æœ€è¿‘100æ¡è®°å½•
        if len(data["sessions"]) > 100:
            data["sessions"] = data["sessions"][-100:]
        
        self.save_data(data)
    
    def enhance_learning_response(self, content):
        """å¢å¼ºå­¦ä¹ ç›¸å…³å›å¤"""
        learning_keywords = ["å­¦ä¼š", "ç†è§£", "æŒæ¡", "å›°æƒ‘", "ä¸æ‡‚", "å­¦ä¹ ", "æ€è€ƒ"]
        
        if any(keyword in content for keyword in learning_keywords):
            return True
        return False
    
    def load_data(self):
        """åŠ è½½æ•°æ®"""
        try:
            with open(self.data_file, 'r', encoding='utf-8') as f:
                return json.load(f)
        except:
            return {"users": {}, "sessions": []}
    
    def save_data(self, data):
        """ä¿å­˜æ•°æ®"""
        with open(self.data_file, 'w', encoding='utf-8') as f:
            json.dump(data, f, ensure_ascii=False, indent=2)
    
    def get_coach_help(self):
        """è·å–å¸®åŠ©"""
        return """ğŸ› ï¸ AIæ•™ç»ƒå·¥å…·åŒ…å‘½ä»¤ï¼š

ğŸ“‹ ä¸ªäººæ¡£æ¡ˆï¼š
/profile set name "å§“å" - è®¾ç½®å§“å
/profile set goal "ç›®æ ‡" - è®¾ç½®ä¸»è¦ç›®æ ‡
/profile show - æŸ¥çœ‹æ¡£æ¡ˆ

ğŸ¯ ç›®æ ‡ç®¡ç†ï¼š
/goals add "ç›®æ ‡" - æ·»åŠ ç›®æ ‡
/goals list - æŸ¥çœ‹ç›®æ ‡åˆ—è¡¨
/goals complete 1 - å®Œæˆç›®æ ‡

ğŸ“ˆ è¿›åº¦è·Ÿè¸ªï¼š
/progress - æŸ¥çœ‹å­¦ä¹ è¿›åº¦

ğŸ¤” æ·±åº¦åæ€ï¼š
/reflect - å¼€å§‹å¼•å¯¼å¼åæ€

ğŸ’¡ ä½¿ç”¨æŠ€å·§ï¼š
- ç›´æ¥å¯¹è¯å³å¯ï¼Œæˆ‘ä¼šè®°å½•ä½ çš„å­¦ä¹ è½¨è¿¹
- æåˆ°"å­¦ä¹ "ã€"å›°æƒ‘"ç­‰è¯æ±‡ä¼šè§¦å‘ç‰¹æ®Šå›åº”
- å®šæœŸä½¿ç”¨ /reflect è¿›è¡Œæ·±åº¦æ€è€ƒ

åŸºäºèœ•å˜å¼å­¦ä¹ ç†å¿µ ğŸ’™"""

    def get_help_text(self, **kwargs):
        return self.get_coach_help()
```

### 2. æ’ä»¶é…ç½®æ–‡ä»¶

```json
// plugins/coach_tools/config.json
{
  "enabled": true,
  "data_retention_days": 90,
  "reflection_frequency": "weekly",
  "goal_reminder": true
}
```

## ğŸŒ æ–¹æ¡ˆä¸‰ï¼šWebç•Œé¢å®šåˆ¶

### 1. è‡ªå®šä¹‰CSSæ ·å¼

```css
/* channel/web/static/custom.css */
.chat-container {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.message.ai {
    background: #f0f8ff;
    border-left: 4px solid #4a90e2;
}

.message.ai::before {
    content: "ğŸ’™ Keith AI Coach";
    font-size: 12px;
    color: #666;
    display: block;
    margin-bottom: 5px;
}

.input-area {
    border-top: 2px solid #4a90e2;
}

.send-button {
    background: #4a90e2;
    color: white;
}
```

### 2. ä¿®æ”¹Webæ¨¡æ¿

```html
<!-- channel/web/templates/chat.html çš„éƒ¨åˆ†ä¿®æ”¹ -->
<title>Keith AI Coach - ä¸“å±å­¦ä¹ ä¼™ä¼´</title>

<div class="header">
    <h1>ğŸ¯ Keith AI Coach</h1>
    <p>åŸºäºèœ•å˜å¼å­¦ä¹ ç†å¿µçš„ä¸“å±AIæ•™ç»ƒ</p>
</div>
```